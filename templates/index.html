<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation Copilot</title>
    <svg width="209" height="77" viewBox="0 0 209 77" xmlns="http://www.w3.org/2000/svg"><title>logo stacked white</title><g fill="none" fill-rule="evenodd"><path d="M112.95.93l-8.38 16.073L96.19.93h16.76M95.952 6.953L92.847.93H79.093l9.982 19.277 6.877 13.253 6.877-13.253L95.95 6.953M113.187 6.953L116.292.93h13.754l-9.982 19.277-6.877 13.253-6.877-13.253 6.877-13.254" fill="#FF5335"/><path d="M20.92 60.324h-3.253L13.83 49.28 9.995 60.325H6.74l-5.804-17h4.007l3.52 11.43 3.813-11.478h3.206l3.812 11.478 3.52-11.43h3.91l-5.803 17M40.208 60.493c-5.246 0-9.01-3.882-9.01-8.68v-.05c0-4.797 3.813-8.728 9.058-8.728 5.245 0 9.01 3.882 9.01 8.68v.05c0 4.797-3.814 8.728-9.058 8.728zm5.147-8.73c0-2.892-2.136-5.304-5.147-5.304-3.012 0-5.1 2.362-5.1 5.256v.048c0 2.894 2.137 5.305 5.148 5.305 3.01 0 5.1-2.364 5.1-5.258v-.048zM64.054 60.493c-5.245 0-9.008-3.882-9.008-8.68v-.05c0-4.797 3.812-8.728 9.057-8.728 5.245 0 9.01 3.882 9.01 8.68v.05c0 4.797-3.814 8.728-9.06 8.728zm5.148-8.73c0-2.892-2.136-5.304-5.148-5.304-3.01 0-5.1 2.362-5.1 5.256v.048c0 2.894 2.138 5.305 5.15 5.305 3.01 0 5.098-2.364 5.098-5.258v-.048zM79.76 60.203V43.325h3.74v13.502h8.474v3.376H79.76M105.945 60.203H97.86V43.325h7.89c3.473 0 5.61 1.712 5.61 4.364v.047c0 1.905-1.02 2.967-2.234 3.64 1.968.748 3.18 1.882 3.18 4.15v.047c0 3.086-2.524 4.63-6.36 4.63zm1.7-11.887c0-1.11-.875-1.736-2.453-1.736h-3.69v3.57h3.448c1.65 0 2.695-.532 2.695-1.786v-.048zm.947 6.75c0-1.132-.85-1.83-2.768-1.83H101.5v3.712h4.445c1.65 0 2.647-.58 2.647-1.832v-.05zM129.244 60.203l-3.643-5.4h-2.937v5.4h-3.74V43.325h7.77c4.008 0 6.412 2.098 6.412 5.57v.048c0 2.724-1.48 4.437-3.643 5.232l4.153 6.028h-4.37zm.072-11.116c0-1.59-1.117-2.41-2.938-2.41h-3.715v4.846h3.788c1.822 0 2.866-.965 2.866-2.387v-.05zM139.985 43.325h3.74v16.878h-3.74V43.325zM159.425 60.493c-5.293 0-8.936-3.69-8.936-8.68v-.05c0-4.797 3.763-8.728 8.91-8.728 3.06 0 4.906.82 6.678 2.316l-2.355 2.822c-1.31-1.086-2.477-1.713-4.443-1.713-2.72 0-4.882 2.387-4.882 5.256v.048c0 3.086 2.137 5.353 5.15 5.353 1.358 0 2.573-.338 3.52-1.013v-2.41h-3.764v-3.208h7.382v7.33c-1.748 1.47-4.153 2.677-7.26 2.677M184.472 60.203v-6.775h-6.896v6.775h-3.74V43.325h3.74v6.68h6.896v-6.68h3.74v16.878h-3.74M203.03 46.75v13.453h-3.74V46.75h-5.17v-3.425h14.083v3.424h-5.173M30.31 74.84h-3.647v-9.285h3.647c2.94 0 4.97 2.003 4.97 4.616v.027c0 2.613-2.03 4.643-4.97 4.643zm2.818-4.643c0-1.644-1.135-2.798-2.818-2.798h-1.59v5.596h1.59c1.683 0 2.818-1.128 2.818-2.772v-.027zM38.47 74.84v-9.285h7.053v1.818h-5.01v1.883h4.41v1.817h-4.41v1.95h5.077v1.817h-7.12M53.672 74.905h-1.816l-3.78-9.35h2.27l2.445 6.54 2.445-6.54h2.217l-3.78 9.35M60.182 74.84v-9.285h7.052v1.818h-5.01v1.883h4.41v1.817h-4.41v1.95h5.077v1.817h-7.118M70.634 74.84v-9.285h2.056v7.428h4.662v1.857h-6.718M84.52 74.998c-2.883 0-4.954-2.135-4.954-4.774v-.027c0-2.64 2.098-4.8 4.983-4.8 2.884 0 4.954 2.134 4.954 4.774v.027c0 2.64-2.097 4.8-4.983 4.8zm2.834-4.8c0-1.592-1.176-2.918-2.833-2.918-1.655 0-2.803 1.3-2.803 2.89v.027c0 1.592 1.175 2.918 2.832 2.918 1.655 0 2.804-1.3 2.804-2.89v-.028zM96.316 72.054h-1.563v2.786h-2.057v-9.285h3.82c2.23 0 3.58 1.314 3.58 3.21v.027c0 2.148-1.683 3.262-3.78 3.262zm1.695-3.25c0-.915-.64-1.405-1.668-1.405h-1.59v2.837h1.63c1.03 0 1.63-.61 1.63-1.406v-.026zM110.276 74.84v-6.062l-2.63 3.966h-.055l-2.603-3.926v6.022h-2.017v-9.285h2.217l2.458 3.927 2.457-3.927h2.217v9.285h-2.044M116.015 74.84v-9.285h7.053v1.818h-5.01v1.883h4.408v1.817h-4.407v1.95h5.074v1.817h-7.12M133.025 74.84l-4.528-5.903v5.903h-2.03v-9.285h1.896l4.38 5.716v-5.715h2.03v9.285h-1.748M142.466 67.44v7.4h-2.057v-7.4h-2.846v-1.885h7.747v1.884h-2.844M147.837 74.84h-.828v-2.123h2.162v1.79c0 1.752-.88 2.454-2.47 2.48l-.174-.835c.92-.093 1.376-.557 1.31-1.312M156.557 65.555h2.058v9.284h-2.058v-9.285zM168.883 74.84l-4.527-5.903v5.903h-2.03v-9.285h1.896l4.382 5.716v-5.715h2.03v9.285h-1.75M178.642 74.998c-2.75 0-4.795-2.108-4.795-4.774v-.027c0-2.64 2.003-4.8 4.875-4.8 1.763 0 2.818.583 3.686 1.432l-1.308 1.498c-.722-.65-1.456-1.048-2.39-1.048-1.577 0-2.713 1.3-2.713 2.89v.027c0 1.592 1.11 2.918 2.712 2.918 1.068 0 1.722-.424 2.456-1.087l1.31 1.312c-.962 1.022-2.03 1.658-3.834 1.658" fill="#666"/></g></svg>
    <h1 style="color:black">Woolbright Conversation Copilot!ðŸš€ </h1>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #d9e0ec;
            padding: 20px;
            text-align: center;
        }
        button {
            background-color: #d385cc;
            color: white;
            padding: 10px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #682583;
        }
        #transcript, #suggestion, #summary {
            background-color: #f7f3f3;
            border: 1px solid #f3eded;
            padding: 10px;
            margin-top: 20px;
            height: 150px;
            overflow-y: auto;
        }
        .container {
            width: 80%;
            margin: 0 auto;
        }
        .output-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div>
        <label for="prompt">Enter your Prompt:</label>
        <textarea id="prompt" rows="10" style="width: 100%;">I'm having a user interview, above is the interview script so far.
I'm building an app to help dental clinics find talents and employees;
                        
You are a world-class UX researcher, give me 2 questions I should ask the user to dive further based on what they say; 
                        
be short, less than 150 words</textarea>
    </div>
    <button id="recordButton">Start Recording</button>
    <button id="suggestionButton">Get Suggestions</button>
    <button id="summaryButton">Get Summary</button>
    <div>Read the Transcript here:</div>
    <div id="transcript"></div>
    <button id="downloadButton">Download Transcript</button>
    <div></div>
    <div>AIðŸ‘®is here to help you with suggestions!</div> 
    <div></div>
    <div id="suggestion"></div>
    <div>Summary:</div>
    <div></div>
    <div id="summary"></div>
    <div></div>

    <script>
        const recordButton = document.getElementById('recordButton');
        const suggestionButton = document.getElementById('suggestionButton');
        const summaryButton = document.getElementById('summaryButton');
        const downloadButton = document.getElementById('downloadButton');
        const transcriptDiv = document.getElementById('transcript');
        const suggestionDiv = document.getElementById('suggestion');
        const summaryDiv = document.getElementById('summary');

        let isRecording = false;
        let mediaRecorder;
        let intervalId;
        let full_transcript = '';

        const username = 'woolbright'; // Replace with your actual username
        const password = 'fLor1daSun'; // Replace with your actual password

        // Function to get the Authorization header value
        function getAuthHeader(username, password) {
            const credentials = btoa(`${username}:${password}`);
            return `Basic ${credentials}`;
        }

        suggestionButton.addEventListener('click', async () => {
            const promptText = document.getElementById('prompt').value;

            const response = await fetch('/get-suggestion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ transcript: full_transcript, prompt: promptText })
            });

            const data = await response.json();
            suggestionDiv.textContent = data.suggestion;
        });

        summaryButton.addEventListener('click', async () => {
            const response = await fetch('/get-summary', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ transcript: full_transcript })
            });

            const data = await response.json();
            summaryDiv.textContent = data.summary;
        });

        recordButton.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
                recordButton.textContent = 'Stop Recording';
            } else {
                stopRecording();
                recordButton.textContent = 'Start Recording';
            }
            isRecording = !isRecording;
        });

        downloadButton.addEventListener('click', () => {
            downloadTranscript();
        });

        async function startRecording() {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.addEventListener('dataavailable', async event => {
                const audioBlob = event.data;
                const formData = new FormData();
                formData.append('audio', audioBlob);

                const response = await fetch('/process-audio', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.transcript) {
                    full_transcript += '\n' + data.transcript;
                    transcriptDiv.textContent = full_transcript;
                }
            });

            mediaRecorder.start();

            intervalId = setInterval(() => {
                mediaRecorder.stop();
                mediaRecorder.start();
            }, 3000);
        }

        function stopRecording() {
            clearInterval(intervalId);
            mediaRecorder.stop();
        }

        function downloadTranscript() {
            const blob = new Blob([full_transcript], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'transcript.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
